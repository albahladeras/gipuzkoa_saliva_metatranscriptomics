rule all:
    input:
        f"results/final/final_report.txt"

#test2

rule concatenate:
    input:
        r1_1=f"resources/reads/{{sample}}_lane1_1.fq.gz",
        r2_1=f"resources/reads/{{sample}}_lane2_1.fq.gz",
        r3_1=f"resources/reads/{{sample}}_lane3_1.fq.gz",
        r4_1=f"resources/reads/{{sample}}_lane4_1.fq.gz",
        r1_2=f"resources/reads/{{sample}}_lane1_2.fq.gz",
        r2_2=f"resources/reads/{{sample}}_lane2_2.fq.gz",
        r3_2=f"resources/reads/{{sample}}_lane3_2.fq.gz",
        r4_2=f"resources/reads/{{sample}}_lane4_2.fq.gz",
    output:
        r1=f"results/reads/{{sample}}_1.fq.gz",
        r2=f"results/reads/{{sample}}_2.fq.gz"
    resources:
        mem_mb=lambda wildcards, input, attempt: max(1*1024, int(input.size_mb * 10) * 2 ** (attempt - 1)),
        runtime=lambda wildcards, input, attempt: max(20, int(input.size_mb / 1024 * 2) * 2 ** (attempt - 1))
    threads: 1
    shell:
        """
        cat {input.r1_1} {input.r2_1} {input.r3_1} {input.r4_1} > {output.r1}
        cat {input.r1_2} {input.r2_2} {input.r3_2} {input.r4_2} > {output.r2}
        """